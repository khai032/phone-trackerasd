<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bind Device</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
<h1>Bind Device</h1>
<p>Allow location to appear on admin map.</p>
<button id="allowLocation">Allow Location</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, push, ref } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAz9MekmxZ3n32vzVkjXpQZdWCA-zzUH9o",
  authDomain: "phone-tracker-82286.firebaseapp.com",
  databaseURL: "https://phone-tracker-82286-default-rtdb.firebaseio.com",
  projectId: "phone-tracker-82286",
  storageBucket: "phone-tracker-82286.appspot.com",
  messagingSenderId: "343819739526",
  appId: "1:343819739526:web:10acad845264bd81c18c07"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

document.getElementById("allowLocation").addEventListener("click", ()=>{
  if(!navigator.geolocation){
    alert("Geolocation not supported.");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    pos=>{
      const latitude = pos.coords.latitude;
      const longitude = pos.coords.longitude;
      const deviceName = navigator.userAgent || "Unknown Device";

      push(ref(db,"devices"),{
        name:deviceName,
        latitude,
        longitude,
        timestamp:Date.now()
      }).then(()=>alert("Location sent! You can close this page."))
      .catch(err=>alert("Failed: "+err));
    },
    err=>alert("Location denied or unavailable. Error code: "+err.code),
    { enableHighAccuracy:true, timeout:10000 }
  );
});
</script>
</body>
</html>
